<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Enjoy a free AI-powered multiplayer snake game with skins and chat. Play online with friends now!">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/output.css" rel="stylesheet">
    <script src="/js/fontawesome.js"></script>
    <title>Multiplayer Snake Game Online Free - Play Now!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #1a1a2e;
            color: #e94560;
            overflow-x: hidden;
        }
        
        .game-container {
            position: relative;
            margin: 0 auto;
            border: 8px solid #e94560;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }
        
        canvas {
            width: 100%;
            height: 100%;
            background-color: #16213e;
            display: block;
        }
        
        .snake-head {
            background-color: #e94560;
            border-radius: 50%;
            box-shadow: 0 0 10px #e94560;
        }
        
        .snake-body {
            background-color: #0f3460;
            border-radius: 30%;
        }
        
        .foods {
            background-color: #f9b208;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .ad-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid #e94560;
            border-radius: 10px;
            padding: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .ad-close {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            cursor: pointer;
        }
        
        .player-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 5px;
            font-size: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #16213e;
            padding: 20px;
            border-radius: 10px;
            border: 5px solid #e94560;
            max-width: 500px;
            width: 90%;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #0f3460;
        }
        
        .power-up {
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .shop-item {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(233, 69, 96, 0.3);
        }
        
        .owned-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #38b000;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 10px;
        }
        
        .chat-message {
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            color: #a0a0a0;
            font-size: 0.8em;
        }
        
        .typing-dots {
            display: inline-flex;
            align-items: center;
        }
        
        .typing-dot {
            width: 5px;
            height: 5px;
            background-color: #a0a0a0;
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.5s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* 新增：带滚动条的玩家列表 */
        .player-list-container {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #e94560 #16213e;
        }
        
        .player-list-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .player-list-container::-webkit-scrollbar-track {
            background: #16213e;
        }
        
        .player-list-container::-webkit-scrollbar-thumb {
            background-color: #e94560;
            border-radius: 6px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <nav class="bg-gray-900 text-white p-4 flex justify-between items-center">
        <div class="flex items-center">
            <i class="fas fa-gamepad text-2xl text-red-500 mr-2"></i>
            <h1 class="text-xl font-bold">Multiplayer Snake Game</h1>
        </div>
        <div class="flex items-center space-x-4">
            <div class="flex items-center">
                <i class="fas fa-coins text-yellow-400 mr-1"></i>
                <span id="coins">0</span>
            </div>
            <button id="shop-btn" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded">
                <i class="fas fa-shopping-cart mr-1"></i>Shop
            </button>
            <button id="leaderboard-btn" class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded">
                <i class="fas fa-trophy mr-1"></i>Leaderboard
            </button>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 py-8 flex flex-col lg:flex-row">
        <!-- 游戏区域 -->
        <div class="lg:w-3/4 lg:pr-4 mb-8 lg:mb-0">
            <div class="game-container mx-auto">
                <canvas id="gameCanvas" width="800" height="600"></canvas>
            </div>
            
            <!-- 游戏控制 -->
            <div class="mt-4 flex justify-center space-x-4">
                <button id="start-btn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg">
                    <i class="fas fa-play mr-2"></i>Start Game
                </button>
                <button id="pause-btn" class="bg-yellow-600 hover:bg-yellow-700 text白色 px-6 py-2 rounded-lg" disabled>
                    <i class="fas fa-pause mr-2"></i>Pause
                </button>
                <button id="multiplayer-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                    <i class="fas fa-users mr-2"></i>Multiplayer
                </button>
            </div>
            
            
            
            <!-- 游戏状态 -->
            <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-sm text-gray-400 mb-2">Current Score</h3>
                    <p id="score" class="text-2xl font-bold">0</p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-sm text-gray-400 mb-2">	High Score</h3>
                    <p id="high-score" class="text-2xl font-bold">0</p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-sm text-gray-400 mb-2">Online Players
                    </h3>
                    <p id="player-count" class="text-2xl font-bold">1</p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-sm text-gray-400 mb-2">Current Speed</h3>
                    <p id="speed" class="text-2xl font-bold">150</p>
                </div>
            </div>
        </div>
        
        <!-- 侧边栏 -->
        <div class="lg:w-1/4">
            <!-- 广告位1 -->
            <div class="ad-container mb-6">
                <button class="ad-close">&times;</button>
                <h3 class="text-center mb-2 text-sm">Sponsored Ad</h3>
                <div class="flex justify-center">
                    <img src="https://via.placeholder.com/250x100?text=游戏广告位" alt="广告" class="rounded">
                </div>
                <p class="text-xs mt-2 text-center">Click the ad to support us</p>
            </div>
            
            <!-- 玩家列表 -->
            <div class="bg-gray-800 p-4 rounded-lg mb-6">
                <h3 class="text-sm text-gray-400 mb-3">Player List</h3>
                <div id="player-list" class="player-list-container space-y-2">
                    <div class="flex items-center">
                        <span class="player-tag bg-red-500">You</span>
                        <span>玩家1</span>
                        <span class="ml-auto text-xs">>0 pts</span>
                    </div>
                </div>
            </div>
            
            <!-- 聊天室 -->
            <div class="bg-gray-800 p-4 rounded-lg mb-6">
                <h3 class="text-sm text-gray-400 mb-3">Game Chatroom</h3>
                <div id="chat-messages" class="h-40 overflow-y-auto mb-3 text-xs space-y-2">
                    <div class="chat-message text-green-400">System: Welcome to Multiplayer Snake Game!</div>
                </div>
                <!-- 正在输入指示器 -->
                <div id="typing-indicator" class="typing-indicator hidden">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span class="ml-2">Other players are typing...</span>
                </div>
                <div class="flex">
                    <input type="text" id="chat-input" class="flex-grow bg-gray-700 text-white px-2 py-1 rounded-l text-xs" placeholder="输入消息...">
                    <button id="chat-send" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded-r text-xs">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            
            <!-- 广告位2 -->
            <div class="ad-container">
                <button class="ad-close">&times;</button>
                <h3 class="text-center mb-2 text-sm">Recommended Game</h3>
                <div class="flex justify-center">
                    <img src="https://via.placeholder.com/250x150?text=推荐游戏广告" alt="广告" class="rounded">
                </div>
                <p class="text-xs mt-2 text-center">Click to learn more</p>
            </div>
        </div>
    </main>
    
    <!-- 商店模态框 -->
    <div id="shop-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl mb-6"><i class="fas fa-shopping-cart mr-2"></i>游戏商店</h2>
            <div class="flex justify-between mb-4">
                <div class="flex items-center">
                    <i class="fas fa-coins text-yellow-400 mr-2"></i>
                    <span id="shop-coins" class="font-bold">0</span> 金币
                </div>
                <button id="refresh-shop" class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs">
                    <i class="fas fa-sync-alt mr-1"></i>刷新商品
                </button>
            </div>
            
            <!-- 皮肤类别 -->
            <h3 class="text-left mb-3 border-b border-gray-700 pb-2"><i class="fas fa-paint-brush mr-2"></i>蛇皮肤</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg relative shop-item">
                    <h3 class="text-sm mb-2">经典红色</h3>
                    <div class="w-full h-20 bg-red-600 mb-2 rounded"></div>
                    <p class="text-xs mb-2">经典默认皮肤</p>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="skin-classic" data-price="0" data-owned="true">
                        已拥有
                    </button>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg relative shop-item">
                    <h3 class="text-sm mb-2">火焰</h3>
                    <div class="w-full h-20 bg-gradient-to-r from-red-500 to-yellow-500 mb-2 rounded"></div>
                    <p class="text-xs mb-2">让你的蛇看起来像火焰一样酷炫!</p>
                    <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="skin-fire" data-price="500">
                        <i class="fas fa-coins mr-1"></i>500金币
                    </button>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg relative shop-item">
                    <h3 class="text-sm mb-2">彩虹</h3>
                    <div class="w-full h-20 bg-gradient-to-r from-red-500 via-yellow-500 to-purple-500 mb-2 rounded"></div>
                    <p class="text-xs mb-2">彩虹色的蛇，让其他玩家羡慕!</p>
                    <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="skin-rainbow" data-price="800">
                        <i class="fas fa-coins mr-1"></i>800金币
                    </button>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg relative shop-item">
                    <h3 class="text-sm mb-2">幽灵</h3>
                    <div class="w-full h-20 bg-gradient-to-r from-gray-300 to-gray-500 mb-2 rounded"></div>
                    <p class="text-xs mb-2">半透明效果，让对手难以看清你的蛇!</p>
                    <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="skin-ghost" data-price="1000">
                        <i class="fas fa-coins mr-1"></i>1000金币
                    </button>
                </div>
            </div>
            
            <!-- 道具类别 -->
            <h3 class="text-left mb-3 border-b border-gray-700 pb-2"><i class="fas fa-magic mr-2"></i>游戏道具</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg shop-item">
                    <h3 class="text-sm mb-2">加速道具</h3>
                    <div class="w-full h-20 bg-blue-500 flex items-center justify-center mb-2 rounded">
                        <i class="fas fa-bolt text-3xl"></i>
                    </div>
                    <p class="text-xs mb-2">游戏开始时获得10秒加速效果</p>
                    <div class="flex items-center">
                        <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="powerup-speed" data-price="300">
                            <i class="fas fa-coins mr-1"></i>300金币
                        </button>
                        <span class="ml-2 text-xs text-gray-400">x<span id="powerup-speed-count">0</span></span>
                    </div>
                </div>
                <div class="bg-gray-808 p-4 rounded-lg shop-item">
                    <h3 class="text-sm mb-2">护盾道具</h3>
                    <div class="w-full h-20 bg-green-500 flex items-center justify-center mb-2 rounded">
                        <i class="fas fa-shield-alt text-3xl"></i>
                    </div>
                    <p class="text-xs mb-2">免疫一次碰撞伤害</p>
                    <div class="flex items-center">
                        <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="powerup-shield" data-price="400">
                            <i class="fas fa-coins mr-1"></i>400金币
                        </button>
                        <span class="ml-2 text-xs text-gray-400">x<span id="powerup-shield-count">0</span></span>
                    </div>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg shop-item">
                    <h3 class="text-sm mb-2">双倍分数</h3>
                    <div class="w-full h-20 bg-purple-500 flex items-center justify-center mb-2 rounded">
                        <i class="fas fa-star text-3xl"></i>
                    </div>
                    <p class="text-xs mb-2">30秒内获得双倍分数</p>
                    <div class="flex items-center">
                        <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="powerup-double" data-price="600">
                            <i class="fas fa-coins mr-1"></i>600金币
                        </button>
                        <span class="ml-2 text-xs text-gray-400">x<span id="powerup-double-count">0</span></span>
                    </div>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg shop-item">
                    <h3 class="text-sm mb-2">迷你蛇</h3>
                    <div class="w-full h-20 bg-pink-500 flex items-center justify-center mb-2 rounded">
                        <i class="fas fa-compress text-3xl"></i>
                    </div>
                    <p class="text-xs mb-2">你的蛇变得更短更难被击中</p>
                    <div class="flex items-center">
                        <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs w-full buy-btn" data-id="powerup-mini" data-price="700">
                            <i class="fas fa-coins mr-1"></i>700金币
                        </button>
                        <span class="ml-2 text-xs text-gray-400">x<span id="powerup-mini-count">0</span></span>
                    </div>
                </div>
            </div>
            
            <!-- 其他类别 -->
            <h3 class="text-left mb-3 border-b border-gray-700 pb-2"><i class="fas fa-gem mr-2"></i>特殊物品</h3>
            <div class="grid grid-cols-1 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg shop-item">
                    <h3 class="text-sm mb-2">改名卡</h3>
                    <div class="w-full h-20 bg-indigo-500 flex items-center justify-center mb-2 rounded">
                        <i class="fas fa-signature text-3xl"></i>
                    </div>
                    <p class="text-xs mb-2">更改你的玩家名称</p>
                    <div class="flex">
                        <input type="text" id="name-input" class="flex-grow bg-gray-700 text-white px-2 py-1 rounded-l text-xs mb-2" placeholder="新名称" maxlength="12">
                        <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded-r text-xs buy-btn" data-id="item-name" data-price="1000">
                            <i class="fas fa-coins mr-1"></i>1000金币
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center space-x-4">
                <button id="close-shop" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg">
                    关闭商店
                </button>
                <button id="inventory-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                    <i class="fas fa-box-open mr-2"></i>My Items
                </button>
            </div>
        </div>
    </div>
    
    <!-- 排行榜模态框 -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl mb-6"><i class="fas fa-trophy mr-2"></i>排行榜</h2>
            
            <div class="flex justify-center mb-4">
                <div class="flex space-x-2">
                    <button id="daily-leaderboard" class="bg-blue-600 text-white px-3 py-1 rounded text-xs active-tab">
                        今日
                    </button>
                    <button id="weekly-leaderboard" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs">
                        本周
                    </button>
                    <button id="alltime-leaderboard" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs">
                        历史
                    </button>
                </div>
            </div>
            
            <div class="mb-6" id="leaderboard-content">
                <div class="leaderboard-item text-yellow-400">
                    <span>1. 超级玩家</span>
                    <span>12500分</span>
                </div>
                <div class="leaderboard-item text-gray-300">
                    <span>2. 贪吃蛇大师</span>
                    <span>9800分</span>
                </div>
                <div class="leaderboard-item text-amber-600">
                    <span>3. 蛇王</span>
                    <span>8750分</span>
                </div>
                <div class="leaderboard-item">
                    <span>4. 游戏高手</span>
                    <span>7600分</span>
                </div>
                <div class="leaderboard-item">
                    <span>5. 新手玩家</span>
                    <span>5400分</span>
                </div>
                <div class="leaderboard-item">
                    <span>6. 快乐吃货</span>
                    <span>4800分</span>
                </div>
                <div class="leaderboard-item">
                    <span>7. 速度之星</span>
                    <span>4200分</span>
                </div>
                <div class="leaderboard-item">
                    <span>8. 躲避高手</span>
                    <span>3900分</span>
                </div>
                <div class="leaderboard-item">
                    <span>9. 幸运玩家</span>
                    <span>3600分</span>
                </div>
                <div class="leaderboard-item">
                    <span>10. 休闲玩家</span>
                    <span>3200分</span>
                </div>
                <div class="leaderboard-item" id="current-player-rank">
                    <span>25. 你 (玩家1)</span>
                    <span>1200分</span>
                </div>
            </div>
            
            <div class="text-xs text-gray-400 mb-4">
                <p>排行榜每小时更新一次。</p>
                <p>前3名玩家将获得金币奖励。</p>
            </div>
            
            <button id="close-leaderboard" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg">
                关闭排行榜
            </button>
        </div>
    </div>
    
    <!-- 物品栏模态框 -->
    <div id="inventory-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl mb-6"><i class="fas fa-box-open mr-2"></i>我的物品</h2>
            
            <!-- 已拥有皮肤 -->
            <h3 class="text-left mb-3 border-b border-gray-700 pb-2"><i class="fas fa-paint-brush mr-2"></i>皮肤</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-sm mb-2">经典红色</h3>
                    <div class="w-full h-20 bg-red-600 mb-2 rounded"></div>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs w-full select-skin-btn" data-id="skin-classic" data-selected="true">
                        <i class="fas fa-check mr-1"></i>已使用
                    </button>
                </div>
            </div>
            
            <!-- 已拥有道具 -->
            <h3 class="text-left mb-3 border-b border-gray-700 pb-2"><i class="fas fa-magic mr-2"></i>道具</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-sm mb-2">加速道具</h3>
                    <div class="w-full h-20 bg-blue-500 flex items-center justify-center mb-2 rounded">
                        <i class="fas fa-bolt text-3xl"></i>
                    </div>
                    <p class="text-xs mb-2">剩余数量: 0</p>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs w-full use-item-btn" data-id="powerup-speed" disabled>
                        使用
                    </button>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-sm mb-2">护盾道具</h3>
                    <div class="w-full h-20 bg-green-500 flex items-center justify-center mb-2 rounded">
                        <i class="fas fa-shield-alt text-3xl"></i>
                    </div>
                    <p class="text-xs mb-2">剩余数量: 0</p>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs w-full use-item-btn" data-id="powerup-shield" disabled>
                        使用
                    </button>
                </div>
            </div>
            
            <button id="close-inventory" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg">
                关闭物品栏
            </button>
        </div>
    </div>
    
    <!-- 游戏结束模态框 -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl mb-4 text-red-500">游戏结束!</h2>
            <p class="mb-2">你的最终分数: <span id="final-score" class="font-bold">0</span></p>
            <p class="mb-4">获得金币: <span id="earned-coins" class="font-bold text-yellow-400">0</span></p>
            <div class="flex justify-center space-x-4">
                <button id="restart-btn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg">
                    <i class="fas fa-redo mr-2"></i>重新开始
                </button>
                <button id="share-btn" class="blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                    <i class="fas fa-share-alt mr-2"></i>分享成绩
                </button>
            </div>
            <div class="mt-6 text-xs text-gray-400">
                <p>观看广告可以获得双倍金币奖励!</p>
                <button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded mt-2" id="watch-ad-btn">
                    <i class="fas fa-ad mr-1"></i>观看广告
                </button>
            </div>
        </div>
    </div>
    
    <!-- 底部信息 -->
    <footer class="bg-gray-900 text-white text-center py-4 text-xs">
        <p>© 2025 Multiplayer Snake Game | Ad revenue supports server maintenance</p>
        <p class="mt-1">Built with HTML5, CSS3, and JavaScript</p>
    </footer>

    <script>
        // 游戏变量
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const gridSize = 20;
const tileCount = canvas.width / gridSize;
const MAX_PLAYERS = 50;
let snake = [];
let foods = [];
let powerUps = [];
let direction = 'right';
let nextDirection = 'right';
let gameRunning = false;
let gamePaused = false;
let score = 0;
let highScore = localStorage.getItem('snakeHighScore') || 0;
let coins = parseInt(localStorage.getItem('snakeCoins')) || 0;
let gameSpeed = 150;
let lastTime = 0;
let isMultiplayer = false;
let players = {};
let playerId = null;
let playerName = '玩家' + Math.floor(Math.random() * 1000);
let inventory = JSON.parse(localStorage.getItem('snakeInventory') || '{"skins":["skin-classic"],"items":{},"selectedSkin":"skin-classic"}');
let socket = null;
let roomId = 'default';
let isTyping = false;
let chatActivity = {};
let snakeHeadColor = '#e94560';
let snakeBodyColor = '#0f3460';

// WebSocket 连接
function connectToServer(newRoomId) {
    roomId = newRoomId;
    socket = new WebSocket(`wss://snake-game-ws.onrender.com?room=${roomId}`);

    socket.onopen = () => {
        addChatMessage('系统', `已连接到房间 ${roomId}`);
        sendPlayerData();
    };

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'init') {
            playerId = data.playerId;
            roomId = data.roomId;
            players = data.data.players;
            foods = Array.isArray(data.data.foods) ? data.data.foods : [];
            powerUps = Array.isArray(data.data.powerUps) ? data.data.powerUps : [];
            updatePlayerList();
            drawGame();
        } else if (data.type === 'players') {
            players = data.data;
            updatePlayerList();
            drawGame();
        } else if (data.type === 'chat') {
            addChatMessage(data.sender, data.message);
        } else if (data.type === 'foods') {
            foods = Array.isArray(data.data) ? data.data : [];
        } else if (data.type === 'powerUps') {
            powerUps = Array.isArray(data.data) ? data.data : [];
        }
    };

    socket.onclose = () => {
        addChatMessage('系统', '与服务器断开连接，正在尝试重连...');
        isMultiplayer = false;
        document.getElementById('multiplayer-btn').innerHTML = '<i class="fas fa-users mr-2"></i>多人模式';
        document.getElementById('multiplayer-btn').classList.remove('bg-purple-600');
        document.getElementById('multiplayer-btn').classList.add('bg-blue-600');
        players = {};
        updatePlayerList();

        setTimeout(() => {
            if (isMultiplayer) {
                addChatMessage('系统', '正在重连...');
                connectToServer(roomId);
            }
        }, 5000);
    };

    socket.onerror = (error) => {
        console.error('WebSocket error:', error);
        addChatMessage('系统', '连接服务器时发生错误');
    };
}

// 初始化游戏
function initGame() {
    snake = [];
    for (let i = 3; i >= 0; i--) {
        snake.push({ x: i, y: 0 });
    }
    
    direction = 'right';
    nextDirection = 'right';
    score = 0;
    updateScore();
    
    applySelectedSkin();

    if (isMultiplayer) {
        sendPlayerData();
    }
}

// 生成食物
function spawnFood() {
    const newFood = {
        x: Math.floor(Math.random() * tileCount),
        y: Math.floor(Math.random() * tileCount),
        hasAd: Math.random() < 0.5
    };
    foods.push(newFood);
}

// 本地生成道具（单人模式）
function spawnPowerUp() {
    if (Math.random() < 0.3) {
        const newPowerUp = {
            x: Math.floor(Math.random() * tileCount),
            y: Math.floor(Math.random() * tileCount),
            type: Math.random() < 0.5 ? 'speed' : 'shield'
        };
        powerUps = [newPowerUp];
    } else {
        powerUps = [];
    }
}

// 游戏主循环
function gameUpdate() {
    if (!gameRunning || gamePaused) return;

    let head = { x: snake[0].x, y: snake[0].y };

    switch (direction) {
        case 'up':
            head.y--;
            break;
        case 'down':
            head.y++;
            break;
        case 'left':
            head.x--;
            break;
        case 'right':
            head.x++;
            break;
    }

    if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
        gameOver();
        return;
    }

    for (let i = 0; i < snake.length; i++) {
        if (head.x === snake[i].x && head.y === snake[i].y) {
            gameOver();
            return;
        }
    }

    if (isMultiplayer) {
        for (let id in players) {
            if (id !== playerId && players[id].snake) {
                for (let segment of players[id].snake) {
                    if (head.x === segment.x && head.y === segment.y) {
                        gameOver();
                        return;
                    }
                }
            }
        }
    }

    let foodEaten = false;
    for (let i = 0; i < foods.length; i++) {
        if (head.x === foods[i].x && head.y === foods[i].y) {
            score += 10;
            if (foods[i].hasAd) {
                score += 5;
                coins += 5;
                updateCoins();
                addChatMessage('系统', '获得广告奖励: +5分和+5金币!');
            }
            foodEaten = true;
            if (isMultiplayer) {
                socket.send(JSON.stringify({ type: 'foodEaten', x: foods[i].x, y: foods[i].y }));
            } else {
                foods.splice(i, 1);
                spawnFood();
            }
            break;
        }
    }

    let powerUpEaten = false;
    if (Array.isArray(powerUps)) {
        for (let i = 0; i < powerUps.length; i++) {
            if (head.x === powerUps[i].x && head.y === powerUps[i].y) {
                if (powerUps[i].type === 'speed') {
                    gameSpeed = Math.max(50, gameSpeed - 20);
                    setTimeout(() => gameSpeed = 150, 10000);
                } else if (powerUps[i].type === 'shield') {
                    // 这里可以添加护盾效果
                }
                powerUpEaten = true;
                if (isMultiplayer) {
                    socket.send(JSON.stringify({ type: 'powerUpEaten', x: powerUps[i].x, y: powerUps[i].y }));
                } else {
                    powerUps.splice(i, 1);
                    spawnPowerUp();
                }
                break;
            }
        }
    }

    if (foodEaten || powerUpEaten) {
        updateScore();
    } else {
        snake.pop();
    }
    snake.unshift(head);
    direction = nextDirection;

    drawGame();
    if (isMultiplayer) sendPlayerData();
}

// 绘制游戏
function drawGame() {
    ctx.fillStyle = '#16213e';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = '#0f3460';
    ctx.lineWidth = 0.5;
    for (let i = 0; i < tileCount; i++) {
        ctx.beginPath();
        ctx.moveTo(i * gridSize, 0);
        ctx.lineTo(i * gridSize, canvas.height);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(0, i * gridSize);
        ctx.lineTo(canvas.width, i * gridSize);
        ctx.stroke();
    }

    for (let i = 0; i < snake.length; i++) {
        if (i === 0) {
            ctx.fillStyle = snakeHeadColor;
            ctx.beginPath();
            ctx.arc(
                snake[i].x * gridSize + gridSize / 2,
                snake[i].y * gridSize + gridSize / 2,
                gridSize / 2,
                0,
                Math.PI * 2
            );
            ctx.fill();
            
            ctx.fillStyle = 'white';
            let eyeOffsetX = 0, eyeOffsetY = 0;
            switch (direction) {
                case 'up':
                    eyeOffsetX = -3;
                    eyeOffsetY = -3;
                    break;
                case 'down':
                    eyeOffsetX = -3;
                    eyeOffsetY = 3;
                    break;
                case 'left':
                    eyeOffsetX = -3;
                    eyeOffsetY = 0;
                    break;
                case 'right':
                    eyeOffsetX = 3;
                    eyeOffsetY = 0;
                    break;
            }
            
            ctx.beginPath();
            ctx.arc(
                snake[i].x * gridSize + gridSize / 2 + eyeOffsetX,
                snake[i].y * gridSize + gridSize / 2 + eyeOffsetY,
                3,
                0,
                Math.PI * 2
            );
            ctx.fill();
        } else {
            ctx.fillStyle = snakeBodyColor;
            ctx.fillRect(
                snake[i].x * gridSize + 2,
                snake[i].y * gridSize + 2,
                gridSize - 4,
                gridSize - 4
            );
        }
    }

    for (let food of foods) {
        ctx.fillStyle = '#f9b208';
        ctx.beginPath();
        ctx.arc(
            food.x * gridSize + gridSize / 2,
            food.y * gridSize + gridSize / 2,
            gridSize / 2 - 2,
            0,
            Math.PI * 2
        );
        ctx.fill();

        if (food.hasAd) {
            ctx.fillStyle = 'white';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('广告', food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2 + 4);
        }
    }

    if (Array.isArray(powerUps)) {
        for (let powerUp of powerUps) {
            ctx.fillStyle = powerUp.type === 'speed' ? '#00b4d8' : '#38b000';
            ctx.beginPath();
            ctx.arc(
                powerUp.x * gridSize + gridSize / 2,
                powerUp.y * gridSize + gridSize / 2,
                gridSize / 2 - 2,
                0,
                Math.PI * 2
            );
            ctx.fill();
            
            ctx.fillStyle = 'white';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(
                powerUp.type === 'speed' ? '⚡' : '🛡️',
                powerUp.x * gridSize + gridSize / 2,
                powerUp.y * gridSize + gridSize / 2
            );
        }
    }

    if (isMultiplayer) {
        for (let id in players) {
            if (id !== playerId && players[id].snake) {
                let otherSnake = players[id].snake;
                let otherColor = players[id].color || '#555';
                
                for (let i = 0; i < otherSnake.length; i++) {
                    if (i === 0) {
                        ctx.fillStyle = otherColor;
                        ctx.beginPath();
                        ctx.arc(
                            otherSnake[i].x * gridSize + gridSize / 2,
                            otherSnake[i].y * gridSize + gridSize / 2,
                            gridSize / 2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                        
                        if (players[id].name) {
                            ctx.fillStyle = 'white';
                            ctx.font = '10px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(
                                players[id].name,
                                otherSnake[i].x * gridSize + gridSize / 2,
                                otherSnake[i].y * gridSize - 5
                            );
                        }
                    } else {
                        ctx.fillStyle = otherColor;
                        ctx.fillRect(
                            otherSnake[i].x * gridSize + 2,
                            otherSnake[i].y * gridSize + 2,
                            gridSize - 4,
                            gridSize - 4
                        );
                    }
                }
            }
        }
    }
}

// 游戏循环
function gameLoop(timestamp) {
    if (!gameRunning || gamePaused) return;

    const deltaTime = timestamp - lastTime;
    if (deltaTime >= gameSpeed) {
        gameUpdate();
        lastTime = timestamp;
    }

    requestAnimationFrame(gameLoop);
}

// 开始游戏
function startGame() {
    if (gameRunning) return;

    initGame();
    gameRunning = true;
    gamePaused = false;

    gameSpeed = 150;
    document.getElementById('start-btn').disabled = true;
    document.getElementById('pause-btn').disabled = false;

    lastTime = performance.now();
    requestAnimationFrame(gameLoop);

    if (!isMultiplayer) {
        foods = [];
        powerUps = [];
        spawnFood();
        spawnPowerUp();
    }
}

// 暂停游戏
function pauseGame() {
    if (!gameRunning) return;

    gamePaused = !gamePaused;

    if (gamePaused) {
        document.getElementById('pause-btn').innerHTML = '<i class="fas fa-play mr-2"></i>继续';
    } else {
        lastTime = performance.now();
        requestAnimationFrame(gameLoop);
        document.getElementById('pause-btn').innerHTML = '<i class="fas fa-pause mr-2"></i>暂停';
    }
}
console.log(`WebSocket server running on ws://0.0.0.0:${port}`);
    </script>
</body>
</html>